<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich"
	template="/WEB-INF/templates/main.xhtml">

	<ui:define name="head">
		<script type="text/javascript">
			$(document).ready( function() {
				$('#addCommentLink').click( function() {
					$.ajax({
						url: "_addComment.jsf",
						success: function(html) {
							$('#modal-from-dom-body').html(html);
						}
					});
					$('#modal-from-dom').modal('toggle');
				});
			});
		</script>
	</ui:define>

	<ui:define name="title"><h:outputText value="#{msg['showTicket.page.title']} #{ticketController.ticket.id}" /></ui:define>

	<ui:define name="content">
		<article>
			<header>
				<h2><h:outputText value="#{ticketController.ticket.summary}" /></h2>
				<i>
					Opened: 
					<h:outputText value="#{ticketController.ticket.createdAt}">
						<f:convertDateTime type="both" timeStyle="short" dateStyle="short" />
					</h:outputText>
				</i>
			</header>
			<section>
				<h:panelGrid columns="4">
					<h:outputText value="Reported By:" />
					<h:outputText value="#{ticketController.ticket.reporter.firstName}
												#{ticketController.ticket.reporter.lastName}" />
					
					<h:outputText value="Owned By:" />
					<h:outputText value="#{ticketController.ticket.developer.firstName} 
												#{ticketController.ticket.developer.lastName}" />
					
					<h:outputText value="Priority:" />
					<h:outputText value="#{ticketController.ticket.priority}" />
					
					<h:outputText value="Status:" />
					<h:outputText value="#{ticketController.ticket.status}" />
				</h:panelGrid>
				<h5>Description:</h5>
				<p>
					<h:outputText value="#{ticketController.ticket.description}" />
				</p>
			</section>
			<h:outputLink id="addCommentLink" value="#" styleClass="btn info" data-controls-modal="modal-from-dom" rendered="#{userController.authenticated}">
				Add a comment
			</h:outputLink>				
			<section>
				<c:forEach items="#{ticketController.ticket.comments}" var="comment">
					<article>
						<div class="row">
							<div class="span9">
								<h:outputText value="From: " />
								<h:outputText value="#{comment.author.firstName} 
														#{comment.author.lastName}" />
							</div>
							<div class="span9">
								<h:outputText value="Posted: " />
								<h:outputText value="#{comment.createdAt}">
									<f:convertDateTime type="both" timeStyle="short" dateStyle="short" />
								</h:outputText>
							</div>
						</div>
					</article>
				</c:forEach>
			</section>
		</article>
	</ui:define>

</ui:composition>